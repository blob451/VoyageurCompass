# Generated by Django 5.2.5 on 2025-08-15 00:04

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ("Data", "0015_add_user_to_analytics_results"),
    ]

    operations = [
        # Add composite index for user analysis history queries (user_id, as_of DESC)
        migrations.RunSQL(
            "CREATE INDEX IF NOT EXISTS analytics_results_user_date_idx ON analytics_results (user_id, as_of DESC);",
            reverse_sql="DROP INDEX IF EXISTS analytics_results_user_date_idx;",
        ),
        # Add index for user + stock queries (prevents duplicate analyses)
        migrations.RunSQL(
            "CREATE INDEX IF NOT EXISTS analytics_results_user_stock_idx ON analytics_results (user_id, stock_id);",
            reverse_sql="DROP INDEX IF EXISTS analytics_results_user_stock_idx;",
        ),
        # Add index for stock symbol lookups if not already present
        migrations.RunSQL(
            'CREATE INDEX IF NOT EXISTS stock_symbol_idx ON "Data_stock" (symbol);',
            reverse_sql="DROP INDEX IF EXISTS stock_symbol_idx;",
        ),
    ]
